!function(t){"use strict";var o,e={max:2,flipbook:null,easeFunction:"ease-in-out",duration:500,when:{}},i={init:function(s){var r=this,h=this.data(),l=t.extend({},e,s);if(!l.flipbook||!l.flipbook.turn("is"))throw n("options.flipbook is required");if(o="WebKitCSSMatrix"in window||"MozPerspective"in document.body.style,"function"!=typeof l.max){var p=l.max;l.max=function(){return p}}for(var d in h.zoom={opts:l,axis:a(0,0),scrollPos:a(0,0),eventQueue:[],mouseupEvent:function(){return i._eMouseUp.apply(r,arguments)},eventTouchStart:u(i._eTouchStart,r),eventTouchMove:u(i._eTouchMove,r),eventTouchEnd:u(i._eTouchEnd,r),flipbookEvents:{zooming:u(i._eZoom,r),pressed:u(i._ePressed,r),released:u(i._eReleased,r),start:u(i._eStart,r),turning:u(i._eTurning,r),turned:u(i._eTurned,r),destroying:u(i._eDestroying,r)}},l.when)Object.prototype.hasOwnProperty.call(l.when,d)&&this.bind("zoom."+d,l.when[d]);for(d in h.zoom.flipbookEvents)Object.prototype.hasOwnProperty.call(h.zoom.flipbookEvents,d)&&l.flipbook.bind(d,h.zoom.flipbookEvents[d]);this.css({position:"relative",overflow:"hidden"}),t.isTouch?(l.flipbook.bind("touchstart",h.zoom.eventTouchStart).bind("touchmove",h.zoom.eventTouchMove).bind("touchend",h.zoom.eventTouchEnd),this.bind("touchstart",i._tap)):this.mousedown(i._mousedown).click(i._tap)},_tap:function(o){var e=t(this),n=e.data().zoom;n.opts.flipbook;if(!n.draggingCorner&&!n.dragging&&function t(o,e){return o[0]!=e[0]&&(!!o.attr("page")||!!o.parent()[0]&&t(o.parent(),e))}(t(o.target),e)){i._addEvent.call(e,"tap",o);var s=i._eventSeq.call(e);s&&e.trigger(s)}},_addEvent:function(t,o){var e=this.data().zoom,i={name:t,timestamp:(new Date).getTime(),event:o};e.eventQueue.push(i),e.eventQueue.length>10&&e.eventQueue.splice(0,1)},_eventSeq:function(){var o=this.data().zoom.eventQueue,e=o.length-1;return e>0&&"tap"==o[e].name&&"tap"==o[e-1].name&&o[e].event.pageX==o[e-1].event.pageX&&o[e].event.pageY==o[e-1].event.pageY&&o[e].timestamp-o[e-1].timestamp<200&&o[e].timestamp-o[e-1].timestamp>50?t.extend(o[e].event,{type:"zoom.doubleTap"}):"tap"==o[e].name?t.extend(o[e].event,{type:"zoom.tap"}):void 0},_prepareZoom:function(){var o,e=0,i=this.data().zoom,n=1/this.zoom("value"),s=i.opts.flipbook,r=s.turn("direction"),u=s.data(),h=s.offset(),l=this.offset(),p={height:s.height()},d=s.turn("view");"double"==s.turn("display")&&s.data().opts.autoCenter?d[0]?d[1]?(p.width=s.width(),o=a(h.left-l.left,h.top-l.top)):(p.width=s.width()/2,e="ltr"==r?0:p.width,o=a("ltr"==r?h.left-l.left:h.left-l.left+p.width,h.top-l.top)):(p.width=s.width()/2,e="ltr"==r?p.width:0,o=a("ltr"==r?h.left-l.left+p.width:h.left-l.left,h.top-l.top)):(p.width=s.width(),o=a(h.left-l.left,h.top-l.top)),i.zoomer||(i.zoomer=t("<div />",{class:"zoomer",css:{overflow:"hidden",position:"absolute",zIndex:"1000000"}}).mousedown((function(){return!1})).appendTo(this)),i.zoomer.css({top:o.y,left:o.x,width:p.width,height:p.height});var c=d.join(",");if(c!=i.zoomerView){i.zoomerView=c,i.zoomer.find("*").remove();for(var f=0;f<d.length;f++)if(d[f]){var m=u.pageObjs[d[f]].offset(),v=t(u.pageObjs[d[f]]);v.clone().transform("").css({width:v.width()*n,height:v.height()*n,position:"absolute",display:"",top:(m.top-h.top)*n,left:(m.left-h.left-e)*n}).appendTo(i.zoomer)}}return{pos:o,size:p}},value:function(){return this.data().zoom.opts.flipbook.turn("zoom")},zoomIn:function(o){var e,n=this,u=this.data().zoom,h=u.opts.flipbook,l=u.opts.max(),p=(h.offset(),this.offset());if(u.zoomIn)return this;h.turn("stop");var d=t.Event("zoom.change");if(this.trigger(d,[l]),d.isDefaultPrevented())return this;var c=i._prepareZoom.call(this),f=c.pos,m=a(c.size.width/2,c.size.height/2),v=t.cssPrefix(),g=t.cssTransitionEnd(),x=h.data().opts.autoCenter;u.scale=l,h.data().noCenter=!0,((e=void 0!==o?"x"in o&&"y"in o?a(o.x-f.x,o.y-f.y):t.isTouch?a(o.originalEvent.touches[0].pageX-f.x-p.left,o.originalEvent.touches[0].pageY-f.y-p.top):a(o.pageX-f.x-p.left,o.pageY-f.y-p.top):a(m.x,m.y)).x<0||e.y<0||e.x>c.width||e.y>c.height)&&(e.x=m.x,e.y=m.y);var z=a((e.x-m.x)*l+m.x,(e.y-m.y)*l+m.y),y=a(c.size.width*l>this.width()?e.x-z.x:0,c.size.height*l>this.height()?e.y-z.y:0),w=a(Math.abs(c.size.width*l-this.width()),Math.abs(c.size.height*l-this.height())),b=a(Math.min(0,c.size.width*l-this.width()),Math.min(0,c.size.height*l-this.height())),_=a(m.x*l-m.x-f.x-y.x,m.y*l-m.y-f.y-y.y);_.y>w.y?y.y=_.y-w.y+y.y:_.y<b.y&&(y.y=_.y-b.y+y.y),_.x>w.x?y.x=_.x-w.x+y.x:_.x<b.x&&(y.x=_.x-b.x+y.x),_=a(m.x*l-m.x-f.x-y.x,m.y*l-m.y-f.y-y.y);var T={};T[v+"transition"]=v+"transform "+u.opts.easeFunction+" "+u.opts.duration+"ms";var E=function(){n.trigger("zoom.zoomIn"),u.zoomIn=!0,u.flipPosition=a(h.css("left"),h.css("top")),h.turn("zoom",l).css({position:"absolute",margin:"",top:0,left:0});var o=h.offset();u.axis=a(o.left-p.left,o.top-p.top),x&&"double"==h.turn("display")&&("ltr"==h.turn("direction")&&!h.turn("view")[0]||"rtl"==h.turn("direction")&&!h.turn("view")[1])&&(u.axis.x=u.axis.x+h.width()/2),n.zoom("scroll",_),n.bind(t.mouseEvents.down,i._eMouseDown),n.bind(t.mouseEvents.move,i._eMouseMove),t(document).bind(t.mouseEvents.up,u.mouseupEvent),n.bind("mousewheel",i._eMouseWheel),setTimeout((function(){u.zoomer.hide(),u.zoomer.remove(),u.zoomer=null,u.zoomerView=null}),50)};return u.zoomer.css(T).show(),g?u.zoomer.bind(g,(function(){t(this).unbind(g),E()})):setTimeout(E,u.opts.duration),u.zoomer.transform(s(y.x,y.y,!0)+r(l,!0)),this},zoomOut:function(o){var e,n=this,u=this.data().zoom,h=u.opts.flipbook,l=1/u.scale,p=t.cssPrefix(),d=t.cssTransitionEnd(),c=this.offset();if(o=void 0!==o?o:u.opts.duration,u.zoomIn){var f=t.Event("zoom.change");if(this.trigger(f,[1]),f.isDefaultPrevented())return this;u.zoomIn=!1,u.scale=1,h.data().noCenter=!1,n.unbind(t.mouseEvents.down,i._eMouseDown),n.unbind(t.mouseEvents.move,i._eMouseMove),t(document).unbind(t.mouseEvents.up,u.mouseupEvent),n.unbind("mousewheel",i._eMouseWheel);var m={};m[p+"transition"]=p+"transform "+u.opts.easeFunction+" "+o+"ms",h.css(m);var v,g=t("<div />",{css:{position:"relative",top:u.flipPosition.y,left:u.flipPosition.x,width:h.width()*l,height:h.height()*l,background:"blue"}}).appendTo(h.parent());v=a(g.offset().left-c.left,g.offset().top-c.top),g.remove();var x=h.data().opts.autoCenter;x&&"double"==h.turn("display")&&(h.turn("view")[0]?h.turn("view")[1]||(v.x="ltr"==h.turn("direction")?v.x+g.width()/4:v.x-g.width()/4):v.x="ltr"==h.turn("direction")?v.x-g.width()/4:v.x+g.width()/4);var z=t.findPos(h[0]);e=a(-h.width()/2-z.left+g.width()/2+v.x+c.left,-h.height()/2-z.top+g.height()/2+v.y+c.top);var y=function(){h[0].style.removeProperty?(h[0].style.removeProperty(p+"transition"),h.transform(h.turn("options").acceleration?s(0,0,!0):"").turn("zoom",1),h[0].style.removeProperty("margin"),h.css({position:"relative",top:u.flipPosition.y,left:u.flipPosition.x})):h.transform("none").turn("zoom",1).css({margin:"",top:u.flipPosition.y,left:u.flipPosition.x,position:"relative"}),x&&h.turn("center"),n.trigger("zoom.zoomOut")};return 0===o?y():d?(h.bind(d,(function(){t(this).unbind(d),y()})),h.transform(s(e.x,e.y,!0)+r(l,!0))):(setTimeout(y,o),h.transform(s(e.x,e.y,!0)+r(l,!0))),this}},flipbookWidth:function(){var t=this.data().zoom.opts.flipbook,o=t.turn("view");return"double"!=t.turn("display")||o[0]&&o[1]?t.width():t.width()/2},scroll:function(e,i,n){var r=this.data().zoom,u=r.opts.flipbook,h=this.zoom("flipbookWidth"),l=t.cssPrefix();if(o){var p={};p[l+"transition"]=n?l+"transform 200ms":"none",u.css(p),u.transform(s(-r.axis.x-e.x,-r.axis.y-e.y,!0))}else u.css({top:-r.axis.y-e.y,left:-r.axis.x-e.x});if(!i){var d,c=a(Math.min(0,(h-this.width())/2),Math.min(0,(u.height()-this.height())/2)),f=a(h>this.width()?h-this.width():(h-this.width())/2,u.height()>this.height()?u.height()-this.height():(u.height()-this.height())/2);e.y<c.y?(e.y=c.y,d=!0):e.y>f.y&&(e.y=f.y,d=!0),e.x<c.x?(e.x=c.x,d=!0):e.x>f.x&&(e.x=f.x,d=!0),d&&this.zoom("scroll",e,!0,!0)}r.scrollPos=a(e.x,e.y)},resize:function(){var t=this.data().zoom,o=t.opts.flipbook;if(this.zoom("value")>1){var e=o.offset(),i=this.offset();t.axis=a(e.left-i.left+(t.axis.x+t.scrollPos.x),e.top-i.top+(t.axis.y+t.scrollPos.y)),"double"!=o.turn("display")||"ltr"!=o.turn("direction")||o.turn("view")[0]||(t.axis.x=t.axis.x+o.width()/2),this.zoom("scroll",t.scrollPos)}},_eZoom:function(){for(var t=this.data().zoom,o=t.opts.flipbook,e=o.turn("view"),i=0;i<e.length;i++)e[i]&&this.trigger("zoom.resize",[t.scale,e[i],o.data().pageObjs[e[i]]])},_eStart:function(t,o){1!=this.zoom("value")&&t.preventDefault()},_eTurning:function(t,o,e){var i=this,n=this.zoom("value"),s=this.data().zoom,r=s.opts.flipbook;if(s.page=r.turn("page"),1!=n){for(var a=0;a<e.length;a++)e[a]&&this.trigger("zoom.resize",[n,e[a],r.data().pageObjs[e[a]]]);setTimeout((function(){i.zoom("resize")}),0)}},_eTurned:function(t,o){if(1!=this.zoom("value")){var e=this.data().zoom,i=e.opts.flipbook;o>e.page?this.zoom("scroll",a(0,e.scrollPos.y),!1,!0):o<e.page&&this.zoom("scroll",a(i.width(),e.scrollPos.y),!1,!0)}},_ePressed:function(){t(this).data().zoom.draggingCorner=!0},_eReleased:function(){var o=t(this).data().zoom;setTimeout((function(){o.draggingCorner=!1}),1)},_eMouseDown:function(o){return t(this).data().zoom.draggingCur=t.isTouch?a(o.originalEvent.touches[0].pageX,o.originalEvent.touches[0].pageY):a(o.pageX,o.pageY),!1},_eMouseMove:function(o){var e=t(this).data().zoom;if(e.draggingCur){e.dragging=!0;var i=t.isTouch?a(o.originalEvent.touches[0].pageX,o.originalEvent.touches[0].pageY):a(o.pageX,o.pageY),n=a(i.x-e.draggingCur.x,i.y-e.draggingCur.y);return t(this).zoom("scroll",a(e.scrollPos.x-n.x,e.scrollPos.y-n.y),!0),e.draggingCur=i,!1}},_eMouseUp:function(o){var e=t(this).data().zoom;e.dragging&&t(this).zoom("scroll",e.scrollPos),e.draggingCur=null,setTimeout((function(){e.dragging=!1}),1)},_eMouseWheel:function(o,e,i,n){var s=t(this).data().zoom,r=a(s.scrollPos.x+10*i,s.scrollPos.y-10*n);t(this).zoom("scroll",r,!1,!0)},_eTouchStart:function(o,e){var i=t(this).data().zoom,n=(i.opts.flipbook,a(o.originalEvent.touches[0].pageX,o.originalEvent.touches[0].pageY));i.touch={},i.touch.initial=n,i.touch.last=n,i.touch.timestamp=(new Date).getTime(),i.touch.speed=a(0,0)},_eTouchMove:function(o){var e=t(this).data().zoom,i=t(this).zoom("value"),n=e.opts.flipbook,s=(new Date).getTime(),r=a(o.originalEvent.touches[0].pageX,o.originalEvent.touches[0].pageY);e.touch&&1==i&&!n.data().mouseAction&&(e.touch.motion=a(r.x-e.touch.last.x,r.y-e.touch.last.y),e.touch.speed.x=0===e.touch.speed.x?e.touch.motion.x/(s-e.touch.timestamp):(e.touch.speed.x+e.touch.motion.x/(s-e.touch.timestamp))/2,e.touch.last=r,e.touch.timestamp=s)},_eTouchEnd:function(o){var e=t(this).data().zoom;if(e.touch&&1==t(this).zoom("value")){var i=Math.abs(e.touch.initial.y-e.touch.last.y);i<50&&(e.touch.speed.x<-1||e.touch.last.x-e.touch.initial.x<-100)?this.trigger("zoom.swipeLeft"):i<50&&(e.touch.speed.x>1||e.touch.last.x-e.touch.initial.x>100)&&this.trigger("zoom.swipeRight")}},_eDestroying:function(){var o=this,e=this.data().zoom,n=e.opts.flipbook;for(var s in this.zoom("zoomOut",0),t.each(["tap","doubleTap","resize","zoomIn","zoomOut","swipeLeft","swipeRight"],(function(t,e){o.unbind("zoom."+e)})),e.flipbookEvents)Object.prototype.hasOwnProperty.call(e.flipbookEvents,s)&&n.unbind(s,e.flipbookEvents[s]);n.unbind("touchstart",e.eventTouchStart).unbind("touchmove",e.eventTouchMove).unbind("touchend",e.eventTouchEnd),this.unbind("touchstart",i._tap).unbind("click",i._tap),e=null,this.data().zoom=null}};function n(t){function o(t){this.name="TurnJsError",this.message=t}return o.prototype=new Error,o.prototype.constructor=o,new o(t)}function s(t,e,i){return o&&i?" translate3d("+t+"px,"+e+"px, 0px) ":" translate("+t+"px, "+e+"px) "}function r(t,e){return o&&e?" scale3d("+t+", "+t+", 1) ":" scale("+t+") "}function a(t,o){return{x:t,y:o}}function u(t,o){return function(){return t.apply(o,arguments)}}t.extend(t.fn,{zoom:function(){var o=arguments;if(o[0]&&"object"!=typeof o[0]){if(i[o[0]])return i[o[0]].apply(t(this[0]),Array.prototype.slice.call(o,1));throw n(o[0]+" is not a method")}return i.init.apply(t(this[0]),o)}})}(jQuery);